@page
@model ModuloPagamentos.Pages.Cartao.CreateModel
@{
    ViewData["Title"] = "Registrar Cartão de Crédito";
}

<div class="mb-4">
    <div class="alert alert-info">
        Este formulário aceita qualquer entrada, inclusive campos vazios, para simular uma requisição HTTPS, onde os campos JSON podem estar faltantes.<br />
        Todas as validações são feitas apenas no backend.
    </div>
</div>

<div class="card shadow-sm mx-auto" style="max-width: 500px;">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="bi bi-credit-card"></i> Registrar Cartão de Crédito</h4>
    </div>
    <div class="card-body">
        <form method="post" autocomplete="off">
            <div class="mb-3">
                <label asp-for="Cartao.Numero" class="form-label"></label>
                <input asp-for="Cartao.Numero" class="form-control" maxlength="19" placeholder="Somente números" id="cartao-numero" />
            </div>
            <div class="mb-3">
                <label asp-for="Cartao.Validade" class="form-label"></label>
                <input asp-for="Cartao.Validade" class="form-control" maxlength="5" placeholder="MM/AA" id="cartao-validade" />
            </div>
            <div class="mb-3">
                <label asp-for="Cartao.CVV" class="form-label"></label>
                <input asp-for="Cartao.CVV" class="form-control" maxlength="4" placeholder="3 ou 4 dígitos" />
            </div>
            <div class="mb-3">
                <label asp-for="Cartao.NomeTitular" class="form-label"></label>
                <input asp-for="Cartao.NomeTitular" class="form-control" placeholder="Nome como está no cartão" />
            </div>
            <div class="mb-3">
                <label asp-for="Cartao.CPF" class="form-label"></label>
                <input asp-for="Cartao.CPF" class="form-control" maxlength="14" placeholder="CPF (somente números)" id="cartao-cpf" />
            </div>
            <button type="submit" class="btn btn-success w-100">Registrar</button>
        </form>

        @if (Model.Sucesso)
        {
            <div class="alert alert-success mt-4">
                Cartão registrado com sucesso!
            </div>
        }
        else if (Model.Erros != null && Model.Erros.Count > 0)
        {
            <div class="alert alert-danger mt-4">
                <strong>Ocorreram os seguintes erros:</strong>
                <ul class="mb-0">
                    @foreach (var erro in Model.Erros)
                    {
                        <li>@erro</li>
                    }
                </ul>
            </div>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Máscara para número do cartão: 1234 5678 9012 3456
            var cartaoNumero = document.getElementById('cartao-numero');
            if (cartaoNumero) {
                cartaoNumero.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/\D/g, '').slice(0, 16);
                    value = value.replace(/(.{4})/g, '$1 ').trim();
                    e.target.value = value;
                });
            }

            // Máscara para validade: MM/AA
            var cartaoValidade = document.getElementById('cartao-validade');
            if (cartaoValidade) {
                cartaoValidade.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/\D/g, '').slice(0, 4);
                    if (value.length > 2) {
                        value = value.slice(0, 2) + '/' + value.slice(2);
                    }
                    e.target.value = value;
                });
            }

            // Máscara para CPF: 000.000.000-00
            var cartaoCpf = document.getElementById('cartao-cpf');
            if (cartaoCpf) {
                cartaoCpf.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/\D/g, '').slice(0, 11);
                    if (value.length > 9)
                        value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                    else if (value.length > 6)
                        value = value.replace(/(\d{3})(\d{3})(\d{3})/, '$1.$2.$3-');
                    else if (value.length > 3)
                        value = value.replace(/(\d{3})(\d{3})/, '$1.$2.');
                    else if (value.length > 0)
                        value = value.replace(/(\d{3})/, '$1.');
                    e.target.value = value;
                });
            }
        });
    </script>
}
